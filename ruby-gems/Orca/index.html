
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-165726602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-165726602-1');
  </script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="description" content="Al-waleed Shihadeh blog">
  <link rel="canonical" href="https://wshihadeh.github.io/">
  <meta name="author" content="wshihadeh">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">
  <link rel="shortcut icon" href="assets/images/favicon.png">
  <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">

    
      
        <title>Swarm Orca - MOD Standards</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ariel':300,400,400i,700%7C&display=fallback">
        <style>:root{--md-text-font-family:"Ariel'";--md-code-font-family:""}</style>
      
    
    
    
      <link rel="stylesheet" href="../../assets/styles/extra.css">
    
      <link rel="stylesheet" href="../../assets/styles/atom-one-light.css">
    
      <link rel="stylesheet" href="../../assets/styles/govuk-frontend-3.14.0.min.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#swarm-orca" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
  
  
  <header class="govuk-header__container md-header" data-md-component="header"  data-module="govuk-header">
    <nav class="md-header__inner md-grid" aria-label="Header">
      <a href="../.." title="MOD Standards" class="govuk-header__link govuk-header__link--homepage" aria-label="MOD Standards" data-md-component="logo">
        <span class="govuk-header__logotype">
          <!--[if gt IE 8]><!-->
          <svg aria-hidden="true" focusable="false" class="govuk-header__logotype-crown" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 132 97" height="30" width="36">
            <path fill="currentColor" fill-rule="evenodd" d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"></path>
          </svg>
          <!--<![endif]-->
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
      </a>
      
      <div class="md-header__title" data-md-component="header-title">
        <div class="md-header__ellipsis">
          <!-- <div class="md-header__topic"> -->
            <span class="md-ellipsis">
              MOD Standards
            </span>
          <!-- </div>           -->
        </div>
      </div>
      

      
      
      
        <label class="md-header__button md-icon" for="__search">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        </label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
     
    </nav>
    

    
    
  </header>
 
  

    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MOD Standards" class="md-nav__button md-logo" aria-label="MOD Standards" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    MOD Standards
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/defencedigital/mod-standards.git/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    MOD-Standards
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Blog/" class="md-nav__link">
        Blog Posts
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          GitHub Actions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="GitHub Actions" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          GitHub Actions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../actions/Docker-Deployment/" class="md-nav__link">
        Docker Deployment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Ruby Gems
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Ruby Gems" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Ruby Gems
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../DeepHealthCheck/" class="md-nav__link">
        DeepHealthCheck
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../DelayedJobMetrics/" class="md-nav__link">
        DelayedJob Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_3">
          FluentD Plugins
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="FluentD Plugins" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          FluentD Plugins
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../DockerMetadata/" class="md-nav__link">
        Docker Metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../EmptyKeys/" class="md-nav__link">
        Empty Keys
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Key-ValueParser/" class="md-nav__link">
        Key-Value Parser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../RecordSplitter/" class="md-nav__link">
        Record Splitter
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../IRBTracker/" class="md-nav__link">
        IRBTracker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../RabbitMQ/" class="md-nav__link">
        RabbitMQ Client
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Swarm Orca
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Swarm Orca
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#command-line" class="md-nav__link">
    Command Line
  </a>
  
    <nav class="md-nav" aria-label="Command Line">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commands" class="md-nav__link">
    Commands
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install_1" class="md-nav__link">
    Install
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-your-services-and-application" class="md-nav__link">
    Define your services and application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-your-services-and-applications-configurations" class="md-nav__link">
    Define your services and applications configurations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-seeds" class="md-nav__link">
    Application Seeds
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-database-migrations" class="md-nav__link">
    Application Database migrations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-strategy" class="md-nav__link">
    Deployment Strategy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#one-time-migrations" class="md-nav__link">
    One Time migrations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-migrations" class="md-nav__link">
    Data migrations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#erb-templates" class="md-nav__link">
    ERB templates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shared-configuration" class="md-nav__link">
    Shared Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-deployment" class="md-nav__link">
    Local Deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encrypted-attribute" class="md-nav__link">
    Encrypted attribute
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#swarm-orca-deployment" class="md-nav__link">
    Swarm Orca Deployment
  </a>
  
    <nav class="md-nav" aria-label="Swarm Orca Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#start-deployment" class="md-nav__link">
    Start deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#swarm-orca-special-roles" class="md-nav__link">
    Swarm Orca special roles
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Security
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Security" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Security
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../security/patching/" class="md-nav__link">
        Patching
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../digital/policy1/" class="md-nav__link">
        Policy document
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#command-line" class="md-nav__link">
    Command Line
  </a>
  
    <nav class="md-nav" aria-label="Command Line">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commands" class="md-nav__link">
    Commands
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install_1" class="md-nav__link">
    Install
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-your-services-and-application" class="md-nav__link">
    Define your services and application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-your-services-and-applications-configurations" class="md-nav__link">
    Define your services and applications configurations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-seeds" class="md-nav__link">
    Application Seeds
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-database-migrations" class="md-nav__link">
    Application Database migrations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-strategy" class="md-nav__link">
    Deployment Strategy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#one-time-migrations" class="md-nav__link">
    One Time migrations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-migrations" class="md-nav__link">
    Data migrations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#erb-templates" class="md-nav__link">
    ERB templates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shared-configuration" class="md-nav__link">
    Shared Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-deployment" class="md-nav__link">
    Local Deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encrypted-attribute" class="md-nav__link">
    Encrypted attribute
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#swarm-orca-deployment" class="md-nav__link">
    Swarm Orca Deployment
  </a>
  
    <nav class="md-nav" aria-label="Swarm Orca Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#start-deployment" class="md-nav__link">
    Start deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#swarm-orca-special-roles" class="md-nav__link">
    Swarm Orca special roles
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              

                <h1 id="swarm-orca">Swarm Orca<a class="headerlink" href="#swarm-orca" title="Permanent link">&para;</a></h1>
<p>This gem includes a set of capistrano recipes used to deploy services and rails applications to a swarm cluster.</p>
<h2 id="command-line">Command Line<a class="headerlink" href="#command-line" title="Permanent link">&para;</a></h2>
<h3 id="install">Install<a class="headerlink" href="#install" title="Permanent link">&para;</a></h3>
<pre class="highlight"><code class="language-sh">$~&gt; gem install swarm_orca</code></pre>
<h3 id="commands">Commands<a class="headerlink" href="#commands" title="Permanent link">&para;</a></h3>
<pre class="highlight"><code class="language-sh">$~&gt; orca decrypt KEY CIPHER # This Command will decrypt the given cipher
$~&gt; orca encrypt KEY TEXT # This Command will encrypt the given text
$~&gt; orca gen_enc_key # This Command will generate new encryption key
$~&gt; orca help [COMMAND] # Describe available commands or one specific command
$~&gt; orca new ORCA_DIRECTORY_NAME GIT_FORK DOCKER_NETWORK  # This Command will create a new Orca project</code></pre>
<h2 id="install_1">Install<a class="headerlink" href="#install_1" title="Permanent link">&para;</a></h2>
<p>Add the following to your <code>Gemfile</code>.</p>
<pre class="highlight"><code class="language-ruby">group :deployment do
  gem 'capistrano'
  gem 'swarm_orca'
end</code></pre>
<p>Then run</p>
<pre class="highlight"><code class="language-sh">$~&gt; bundle install</code></pre>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<ul>
<li>Add the following to your <code>Capfile</code>.</li>
</ul>
<pre class="highlight"><code class="language-ruby">require "swarm_orca"</code></pre>
<ul>
<li>Add the following to your <code>deploy.rb</code>.</li>
</ul>
<pre class="highlight"><code class="language-ruby">require "capistrano/swarm_orca/set_global_config"

set :fork, "${YOUR_FORK_NAME}"
# example

set (:db_apps_stacks_mapping), {
  core: %w(api-backend mobile-backedn),
  frontend: %w(),
}

require "capistrano/swarm_orca/deploy"
require "capistrano/swarm_orca/docker"
</code></pre>
<h2 id="define-your-services-and-application">Define your services and application<a class="headerlink" href="#define-your-services-and-application" title="Permanent link">&para;</a></h2>
<p>Swarm orca define the managed services and applications in <code>deploy.rb</code>.</p>
<ul>
<li>service_stacks: array include the services stack names. That do not need custome docker images and do not have a database.</li>
<li>service_stacks_with_build_image: services that need a custome docker image.</li>
<li>db_apps_stacks_mapping: stacks for your rails application. keys are the stack names and values are the database application names. For example, the core stack include two database applications. While the frontend have no database application.</li>
</ul>
<pre class="highlight"><code class="language-ruby">set (:db_apps_stacks_mapping), {
  core: %w(api-backend mobile-backedn),
  frontend: %w(),
}</code></pre>
<ul>
<li>elasticsearch_apps: application names that are connected to elasticsearch.</li>
</ul>
<h2 id="define-your-services-and-applications-configurations">Define your services and applications configurations<a class="headerlink" href="#define-your-services-and-applications-configurations" title="Permanent link">&para;</a></h2>
<p>Swarm Orca manage the stacks and application configurations in the stage files under <code>capistrano/config/deploy</code></p>
<ul>
<li>each stack must have the <code>stack_name</code> to define the stack name.</li>
<li>docker image , tag and other configs can be configured in the same way. These items depend on the stack file <code>orca/application_stack</code> it self and the applications needed by the application.</li>
</ul>
<pre class="highlight"><code class="language-ruby">set :mysql,
    stack_name: 'mysql',
    mysql_docker_image: 'mysql',
    mysql_docker_image_tag: '5.7',
    mysql_volume: "#{fetch(:deploy_to)}/mysql"</code></pre>
<ul>
<li>Special config keys:
  {application}_database_url: Database URL for the rails application.
  docker_image_prefix: docker image prefix(host and namespace)
  {application}_docker_image: Docker image name
  {application}_docker_image_tag: Docker image tag.</li>
</ul>
<h2 id="application-seeds">Application Seeds<a class="headerlink" href="#application-seeds" title="Permanent link">&para;</a></h2>
<ul>
<li>Define your application seeds<ul>
<li>By default Swarm orca gem will execute <code>rake db:seed</code> to run the seeds for your defined applications.</li>
<li>In Addition, Swarm orca gem support custom seeds. To implement a custom seed in your Orca please follow these instruction.<ul>
<li>Create a new folder in the root directory and call it "seeds".</li>
<li>Add a seed file for each of your application. The file name should follow this schema "${application_name}.rb"</li>
<li>Example of seeds for backend application</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="highlight"><code class="language-ruby">cat seeds/backend.rb
Rails.application.load_tasks
Rake::Task['roles:reseed_defaults'].execute</code></pre>
<h2 id="application-database-migrations">Application Database migrations<a class="headerlink" href="#application-database-migrations" title="Permanent link">&para;</a></h2>
<ul>
<li>Define migrations, seeds and elasticsearch reindex.<ul>
<li>To be able to execute migrations, seeds and elasticsearch reindex, you need to explicitly define the roles on your stage.</li>
<li>Example: our backend stack is using db and elasticsearch</li>
</ul>
</li>
</ul>
<pre class="highlight"><code class="language-ruby">server "${server}", user: "deploy", roles: %w{${stack}_db ${stack}_reindex}
server "${server}", user: "deploy", roles: %w{backend_db backend_reindex}</code></pre>
<h2 id="deployment-strategy">Deployment Strategy<a class="headerlink" href="#deployment-strategy" title="Permanent link">&para;</a></h2>
<p>By default capistrano supports only git deployment strategy to support xopy strategy do the following:</p>
<ul>
<li>Apply these changes to your <code>Capfile</code></li>
</ul>
<pre class="highlight"><code class="language-diff">  -require "capistrano/scm/git"
  +scm = ENV.fetch('SCM', 'git')
  +require "capistrano/scm/#{scm}"
  +install_plugin Module.const_get("Capistrano::SCM::#{scm.capitalize}")</code></pre>
<ul>
<li>To deploy with Copy strategy add "SCM=copy" to the command line.</li>
</ul>
<pre class="highlight"><code class="language-sh">$~&gt; SCM=copy bundle exec cap ${stage} deploy:${stack}</code></pre>
<h2 id="one-time-migrations">One Time migrations<a class="headerlink" href="#one-time-migrations" title="Permanent link">&para;</a></h2>
<ul>
<li>Execute One Time migrations from orca.<ul>
<li>Orca generate a rake task for executing one time migrations for each of the defined database application.</li>
<li>These tasks are defined like the following example.</li>
</ul>
</li>
</ul>
<pre class="highlight"><code class="language-ruby">deploy:otm_${application}[${migration_name}]
# deploy:otm_backend[update_referral_bonus_transactions_text]</code></pre>
<ul>
<li>The migration task should be defined in the project source code under the name space "one_time_migrations"</li>
</ul>
<h2 id="data-migrations">Data migrations<a class="headerlink" href="#data-migrations" title="Permanent link">&para;</a></h2>
<p>To support data migration for individual applications, do the following.
    - Add a new configuration item with the following pattern "${app_name}_data_migrate" to your stack configurations. The value of the item must be true to switch db:migrate to db:migrate:with_data. See the example below for add migrate with data support to a backend application.</p>
<pre class="highlight"><code class="language-ruby">set :backend, {
    stack_name: 'backend',
    backend_data_migrate: 'true',
....
  }</code></pre>
<h2 id="erb-templates">ERB templates<a class="headerlink" href="#erb-templates" title="Permanent link">&para;</a></h2>
<ul>
<li>Setup Stacks ERB templates<ul>
<li>Create an ERB template for each of your stacks. Use the extension "erb" for your stacks.<ul>
<li>Example : docker-stack-backend.yml.erb</li>
</ul>
</li>
<li>Add the following line to deploy.rb<ul>
<li>set (:docker_erb_templates) { true }</li>
</ul>
</li>
<li>Ensure the all container environment variables are double-qouted</li>
</ul>
</li>
</ul>
<h2 id="shared-configuration">Shared Configuration<a class="headerlink" href="#shared-configuration" title="Permanent link">&para;</a></h2>
<ul>
<li>To set shared configurations that are available for all stacks, use the following syntax.</li>
</ul>
<pre class="highlight"><code class="language-ruby">  set :shared, {
     global_variable: 'value_123'
  }</code></pre>
<ul>
<li>To set shared application configurations that are available in all stacks with special key.
Need to create shared application set like:</li>
</ul>
<pre class="highlight"><code class="language-ruby">  set :backend_shared, {
     environment_label: "staging",
  }</code></pre>
<p>Add special key to include shared application config to application config</p>
<pre class="highlight"><code class="language-ruby">  set :web_backend {
    include_shared_config: 'backend_shared',
  }
  set :mobile_backend {
    include_shared_config: 'backend_shared',
  }</code></pre>
<h2 id="local-deployment">Local Deployment<a class="headerlink" href="#local-deployment" title="Permanent link">&para;</a></h2>
<ul>
<li>Support Local Deployment with Swarm Orca<ul>
<li>
<p>To Be able to deploy locally with orca, you need to implement the following changes on your orca project.</p>
<ul>
<li>Create a local stage with your configs. See below template.</li>
</ul>
<pre class="highlight"><code class="language-ruby">  server "${server}", ENV.fetch('USER', '${user}'),
  roles: %w{
    swarm_manager
  }
  set (:deploy_to) { "${deploy_to_path}" }</code></pre>
<ul>
<li>${server}: Can be replaced by by "localhost", "127.0.0.1" or any domain that include "local" in it.</li>
<li>${user}: Default it will use the ENV 'USER' value, but if this ENV 'USER' is not defined, you can also defined another/own user.</li>
<li>${deploy_to_path}: the destination deploy to path.</li>
<li>You mast include at least  "swarm_manager" role.<ul>
<li>Example deploying mysql and rabbitMq</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="highlight"><code class="language-ruby">  server "127.0.0.1", ENV.fetch('USER', 'shihadeh'),
  roles: %w{
    mysql
    rabbitmq
    swarm_manager
  }
  set (:deploy_to) { "/Users/shihadeh/ggs" }
  # set the path to the docker command.
  set (:docker_path) { "" }
  set :mysql, {
    stack_name: 'mysql',
    mysql_docker_image: 'mysql',
    mysql_docker_image_tag: '5.7',
  }
  set :rabbitmq, {
    rabbitmq_docker_image: 'rabbitmq',
    stack_name: 'rabbitmq_fr',
    rabbitmq_docker_image_tag: '3.6-management',
    rabbitmq_volume: '/Users/shihadeh/ggs/rmq'
  }</code></pre>
<h2 id="encrypted-attribute">Encrypted attribute<a class="headerlink" href="#encrypted-attribute" title="Permanent link">&para;</a></h2>
<p>To support encrypted configuration do the follwing:</p>
<ul>
<li>Create a new encryption key using orc cli.</li>
<li>Use orca cli to encrypt the attributes.</li>
<li>set the encrypted attributes (you must prefix the attribute key with 'encrypted_' ie. <code>encrypted_cs_database_url</code>). for instance</li>
</ul>
<pre class="highlight"><code class="language-ruby">set :backend,
  stack_name: 'backend',
  backend_docker_image: 'backend',
  backend_docker_image_tag: 'develop',
  encrypted_backend_database_url: 'h/UNau5AFvhxDbUkBZbPw6RBJzkTPjIMmWOQ+lQ==',</code></pre>
<ul>
<li>export the encryption key one the machine where the deployemnt scripts will be executed ie (your local machine or jenkins nodes).</li>
</ul>
<h2 id="swarm-orca-deployment">Swarm Orca Deployment<a class="headerlink" href="#swarm-orca-deployment" title="Permanent link">&para;</a></h2>
<h3 id="start-deployment">Start deployment<a class="headerlink" href="#start-deployment" title="Permanent link">&para;</a></h3>
<ul>
<li>You can use the following commands to setup and deploy locally</li>
</ul>
<pre class="highlight"><code class="language-sh"># setup and deploy, it will created dbs, and run seeds
$~&gt; bundle exec cap ${stage} deploy:development_setup</code></pre>
<ul>
<li>Build custom docker images manually</li>
</ul>
<pre class="highlight"><code class="language-sh">$~&gt; bundle exec cap ${stage} deploy:build_images</code></pre>
<ul>
<li>Deploy individual stacks</li>
</ul>
<pre class="highlight"><code class="language-sh">$~&gt; bundle exec cap ${stage} deploy:${stack}</code></pre>
<ul>
<li>Deployment with specific fork
Swarm orca defines a defult for for deployment. The fork value can be changed by setting the ENV 'FORK'.</li>
</ul>
<pre class="highlight"><code class="language-sh">$~&gt; FORK=${forkName}  bundle exec cap ${stage} deploy:${stack}</code></pre>
<p>Example deploying with fork 'shihadeh'</p>
<pre class="highlight"><code class="language-sh">$~&gt; FORK=shihadeh bundle exec cap ${stage} deploy:${stack}</code></pre>
<ul>
<li>Deploy more than one stack</li>
</ul>
<pre class="highlight"><code class="language-sh">$~&gt; DEPLOYED_STACKS="mysql rabbitmq" bundle exec cap ${stage} deploy:auto</code></pre>
<ul>
<li>Deploy without building docker images.</li>
</ul>
<pre class="highlight"><code class="language-sh">$~&gt; BUILD_IMAGE=false bundle exec cap ${stage} deploy:${stack}</code></pre>
<ul>
<li>Deploy all</li>
</ul>
<pre class="highlight"><code class="language-sh">$~&gt; bundle exec cap ${stage} deploy:all</code></pre>
<ul>
<li>Recreate DBS for an environment
Use deploy:recreate_all_dbs task to return an envornment(stage) databases to the initial stage</li>
</ul>
<pre class="highlight"><code class="language-sh">$~&gt; bundle exec cap ${stage} deploy:recreate_all_dbs</code></pre>
<ul>
<li>Deploy Debug Mode</li>
</ul>
<pre class="highlight"><code class="language-sh">$~&gt; ORCA_DEBUG=true bundle exec cap ${stage} ${task}</code></pre>
<ul>
<li>Deployment without cleaning up old docker images.
Add the <code>PRUNE=false</code> variable to your deployment command.</li>
</ul>
<pre class="highlight"><code class="language-sh">$~&gt; PRUNE=false bundle exec cap local deploy:auto</code></pre>
<h2 id="swarm-orca-special-roles">Swarm Orca special roles<a class="headerlink" href="#swarm-orca-special-roles" title="Permanent link">&para;</a></h2>
<ul>
<li>swarm_manager : Nodes with this command will be used to execute deployment commands. You only need one node this role per stage.</li>
<li>swarm_node: Swarm Orca will try to cleanup old images or containers on the nodes with this role.</li>
<li>stack: To be able to deploy service X to a given cluster, you must to include the X as a role for a manager node in that cluster.</li>
<li><code>#{stack}_db</code>: This role indeicate where the database migration will be executed.</li>
<li><code>#{stack}_reindex</code>: This role indeicate where the elasticsearch reindexing will be executed.</li>
</ul>
              
                

              
                


              
            </article>
          </div>
        </div>
        
      </main>
      


<!-- 
  <div class="govuk-width-container ">
    <div class="govuk-footer__meta">
      <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">
        <h2 class="govuk-visually-hidden">Support links</h2> -->


<!-- Application footer -->
<footer class="govuk-footer " role="contentinfo">
  <div class="govuk-width-container ">
    <div class="govuk-footer__meta">
      <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">
        <h2 class="govuk-visually-hidden">Support links</h2>
        <ul class="govuk-footer__inline-list">
          <li class="govuk-footer__inline-list-item">
            <a class="govuk-footer__link" href="#1">
              Help
            </a>
          </li>
          <li class="govuk-footer__inline-list-item">
            <a class="govuk-footer__link" href="#2">
              Cookies
            </a>
          </li>
          <li class="govuk-footer__inline-list-item">
            <a class="govuk-footer__link" href="#3">
              Contact
            </a>
          </li>
          <li class="govuk-footer__inline-list-item">
            <a class="govuk-footer__link" href="#4">
              Terms and conditions
            </a>
          </li>
        </ul>

        <svg aria-hidden="true" focusable="false" class="govuk-footer__licence-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 483.2 195.7" height="17" width="41">
          <path fill="currentColor" d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145" />
        </svg>
        <span class="govuk-footer__licence-description">
          All content is available under the
          <a class="govuk-footer__link" href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license">Open Government Licence v3.0</a>, except where otherwise stated
        </span>
      </div>
      <div class="govuk-footer__meta-item">
        <a class="govuk-footer__link govuk-footer__copyright-logo" href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/">Â© Crown copyright</a>
      </div>
    </div>
  </div>
</footer>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.b1047164.min.js"></script>
      
        <script src="../../assets/js/hljs/highlight.pack.js"></script>
      
        <script src="../../assets/js/extra.js"></script>
      
    
  </body>
</html>